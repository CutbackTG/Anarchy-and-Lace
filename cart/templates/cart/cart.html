{% extends "base.html" %}
{% load static %}

{% block content %}
<section class="shop">
  <header class="shop-header glass-panel" style="padding:18px;">
    <h1 style="margin:0 0 6px;">Your cart</h1>
    <p style="margin:0;">{{ cart_count }} item{{ cart_count|pluralize }} in your cart.</p>
  </header>

  <div style="height:14px;"></div>

  <div class="glass-panel" style="padding:18px;">
    {% if items %}
      <div style="display:grid; gap:14px;">
        {% for item in items %}
          <div style="display:grid; grid-template-columns: 92px 1fr auto; gap:14px; align-items:center; padding:12px; border:1px solid var(--panel-border); border-radius: var(--radius-sm); background: rgb(var(--panel-base) / 6%);">

            <div style="width:92px; aspect-ratio: 4 / 5; overflow:hidden; border-radius: 12px; border: 1px solid var(--panel-border); background: rgb(var(--panel-base) / 8%);">
              {% with img=item.product.images.first %}
                {% if img and img.image %}
                  <img src="{{ img.image.url }}" alt="{{ item.product.name }}" style="width:100%; height:100%; object-fit:cover; display:block;">
                {% else %}
                  <div style="height:100%; display:grid; place-items:center; color:var(--ink-muted); font-size:12px;">No image</div>
                {% endif %}
              {% endwith %}
            </div>

            <div>
              <div style="display:flex; justify-content:space-between; gap:12px; align-items:start;">
                <div>
                  <div style="font-weight:600; color:var(--ink);">{{ item.product.name }}</div>
                  <div style="color:var(--ink-muted); font-size: 13px;">£{{ item.product.price }}</div>
                </div>
                <div style="text-align:right; color:var(--ink); font-weight:600;">
                  £{{ item.line_total }}
                </div>
              </div>

              <div style="display:flex; align-items:center; gap:10px; margin-top:10px; flex-wrap:wrap;">
                <form method="post" action="{% url 'cart:set_qty' item.product.id %}" style="display:flex; gap:8px; align-items:center;">
                  {% csrf_token %}
                  <label class="small" style="color:var(--ink-muted); margin:0;">Qty</label>
                  <input type="number" name="qty" min="0" max="99" value="{{ item.qty }}" style="width:86px;">
                  <button class="button" type="submit">Update</button>
                </form>

                <form method="post" action="{% url 'cart:remove' item.product.id %}">
                  {% csrf_token %}
                  <button class="button button--danger" type="submit">Remove</button>
                </form>
              </div>
            </div>

            <div style="display:none;"></div>
          </div>
        {% endfor %}
      </div>

      <div class="kintsugi-line" style="margin:18px 0;"></div>

      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
        <div>
          <div style="color:var(--ink-muted); font-size:13px;">Subtotal</div>
          <div style="font-size:20px; font-weight:700; color:var(--ink);">£{{ subtotal }}</div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <form method="post" action="{% url 'cart:clear' %}">
            {% csrf_token %}
            <button class="button button--danger" type="submit">Clear cart</button>
          </form>

          <button class="button button--gold" type="button" disabled>
            Checkout (next)
          </button>
        </div>
      </div>
    {% else %}
      <p style="margin:0; color:var(--ink-muted);">Your cart is empty.</p>
      <div style="margin-top:12px;">
        <a class="button button--gold" href="{% url 'catalog:product_list' %}">Continue shopping</a>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
