{% extends "base.html" %}
{% load static %}

{% block content %}
<section class="product-list">
  <div class="container">
    <h1 class="section-title">Our Products</h1>

    <!-- Filters (Optional) -->
    <div class="filters">
      <h4>Filter Products:</h4>
      <form method="get" action="{% url 'catalog:product_list' %}">
        <div class="filter-category">
          <label for="category">Category:</label>
          <select name="category" id="category">
            <option value="">All</option>
            {% for category in categories %}
              <option value="{{ category.id }}" {% if category.id == request.GET.category %}selected{% endif %}>{{ category.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="filter-price">
          <label for="min_price">Price Range:</label>
          <input type="number" name="min_price" id="min_price" placeholder="Min" value="{{ request.GET.min_price }}">
          <input type="number" name="max_price" id="max_price" placeholder="Max" value="{{ request.GET.max_price }}">
        </div>

        <button type="submit" class="filter-button">Apply Filters</button>
      </form>
    </div>

    <!-- Product List -->
    <div class="product-gallery">
      {% if products %}
        <div class="product-items">
          {% for product in products %}
            <div class="product-item">
              <div class="product-image">
                {% if product.images.first %}
                  <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" loading="lazy">
                {% else %}
                  <div class="no-image-placeholder">No image</div>
                {% endif %}
              </div>
              <div class="product-info">
                <h3 class="product-name">{{ product.name }}</h3>
                <p class="product-price">Â£{{ product.price }}</p>

                <div class="product-condition">
                  <strong>Condition:</strong> {{ product.get_condition_grade_display }}
                </div>

                {% if product.description %}
                  <p class="product-desc">{{ product.description|truncatewords:20 }}</p>
                {% endif %}

                <div class="product-actions">
                  <a href="{% url 'catalog:product_detail' product.id %}" class="button button--view">View Details</a>
                  <form method="post" action="{% url 'cart:add' product.id %}" class="add-to-cart-form">
                    {% csrf_token %}
                    <button type="submit" class="button button--add-to-cart">Add to Cart</button>
                  </form>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        <div class="pagination">
          {% if products.has_previous %}
            <a href="?page=1" class="pagination-link">First</a>
            <a href="?page={{ products.previous_page_number }}" class="pagination-link">Prev</a>
          {% endif %}
          <span class="current-page">Page {{ products.number }} of {{ products.paginator.num_pages }}</span>
          {% if products.has_next %}
            <a href="?page={{ products.next_page_number }}" class="pagination-link">Next</a>
            <a href="?page={{ products.paginator.num_pages }}" class="pagination-link">Last</a>
          {% endif %}
        </div>
      {% else %}
        <p>No products found matching your criteria.</p>
      {% endif %}
    </div>
  </div>
</section>

<script src="{% static 'js/product_list.js' %}"></script>
{% endblock %}
